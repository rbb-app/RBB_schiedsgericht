<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>RBB Schiedsgericht Punkte</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="icon.png">
<link rel="manifest" href="manifest.json">

<style>
:root { --bg:#fff; --fg:#000; --card:#f2f2f2; }
@media (prefers-color-scheme: dark){
  :root { --bg:#121212; --fg:#fff; --card:#1e1e1e; }
}
body{
  font-family:Arial;
  margin:0;
  padding:10px;
  background:var(--bg);
  color:var(--fg);
  min-height:100vh;
  display:flex;
  flex-direction:column;
}
input,select,button{padding:6px;font-size:15px;margin:3px;}
h2,h3{text-align:center;}
.container{display:flex;gap:10px;flex-wrap:wrap;}
.team{flex:1;background:var(--card);border-radius:10px;padding:10px;min-width:140px;}
.players{display:flex;flex-wrap:wrap;gap:6px;}
.player{
  padding:10px;border:3px solid #666;border-radius:10px;
  min-width:60px;text-align:center;cursor:pointer;position:relative;
}
.player.active{background:rgba(0,255,0,.15);}
.player span.remove{
  position:absolute; top:2px; right:4px; color:red; font-weight:bold; cursor:pointer;
}
.status{text-align:center;font-weight:bold;margin-top:6px;}
.ok{color:#4caf50;} .fail{color:#f44336;}
button{cursor:pointer;}
.periods{display:flex;gap:5px;justify-content:center;margin-bottom:10px; flex-wrap:wrap;}
.periods div{
  padding:12px 16px; border-radius:8px; border:1px solid #666; cursor:pointer; user-select:none;
  min-width:70px; text-align:center; transition: background 0.2s, transform 0.1s;
  touch-action: manipulation;
}
.periods div:active{
  transform: scale(0.95);
}
.periods div.active{background:#4caf50;color:#fff;}
.input-row{display:flex;flex-wrap:wrap;gap:5px;justify-content:center;margin-bottom:10px;}
.input-row input, .input-row select{width:60px; text-align:center;}
.input-row button{padding:6px 12px;}
</style>
</head>

<body>

<h2>Rollstuhlbasketball – Schiedsgericht</h2>

<h3>Spiel-Setup</h3>
<div style="text-align:center;">
Heim: <input id="nameHeim">
Gast: <input id="nameGast"><br>

<div class="periods" id="periods">
  <div data-period="1">1. Viertel</div>
  <div data-period="2">2. Viertel</div>
  <div data-period="3">3. Viertel</div>
  <div data-period="4">4. Viertel</div>
  <div data-period="V">Verlängerung</div>
</div>

<button onclick="startGame()">Spiel starten</button>
<button onclick="endGame()">Spiel beenden</button>
</div>

<h3>Spieler anlegen</h3>
<div class="input-row">
  Nr: <input id="num" type="number">
  Pkt: <input id="pts" type="number" step="0.5" min="-0.5" max="4.5">
  Team:
  <select id="teamSelect">
    <option value="heim">Heim</option>
    <option value="gast">Gast</option>
  </select>
  <button onclick="addPlayer()">+</button>
</div>

<div class="container">
<div class="team">
<h3 id="heimTitle"></h3>
<div id="heimPlayers" class="players"></div>
<div id="heimStatus" class="status"></div>
</div>

<div class="team">
<h3 id="gastTitle"></h3>
<div id="gastPlayers" class="players"></div>
<div id="gastStatus" class="status"></div>
</div>
</div>

<script>
let players = JSON.parse(localStorage.getItem("players")) || [];
let active = JSON.parse(localStorage.getItem("active")) || { heim:[], gast:[] };
let log = JSON.parse(localStorage.getItem("log")) || [];
let currentPeriod = localStorage.getItem("currentPeriod") || "1";

const nameHeim = document.getElementById("nameHeim");
const nameGast = document.getElementById("nameGast");
const periodsDiv = document.getElementById("periods");

nameHeim.value = localStorage.getItem("nameHeim") || "Heim";
nameGast.value = localStorage.getItem("nameGast") || "Gast";

// Perioden Toggle
function setPeriod(period){
  currentPeriod = period;
  localStorage.setItem("currentPeriod", period);
  renderPeriods();
}

function renderPeriods(){
  Array.from(periodsDiv.children).forEach(div=>{
    div.classList.toggle("active", div.dataset.period===currentPeriod);
  });
}

Array.from(periodsDiv.children).forEach(div=>{
  div.onclick = ()=>setPeriod(div.dataset.period);
});

// Speicherfunktion
function save(){
  localStorage.setItem("players", JSON.stringify(players));
  localStorage.setItem("active", JSON.stringify(active));
  localStorage.setItem("log", JSON.stringify(log));
  localStorage.setItem("nameHeim", nameHeim.value);
  localStorage.setItem("nameGast", nameGast.value);
  localStorage.setItem("currentPeriod", currentPeriod);
}

// Spiel starten
function startGame(){
  alert("Spiel gestartet: " + new Date().toLocaleString());
}

// Spiel beenden
function endGame(){
  if(confirm("Spiel wirklich beenden?")) {
    // Log herunterladen
    let csv = "Zeit;Periode;Team;Spieler;Punkte\n";
    log.forEach(l=>{
      csv += `${l.time};${l.period};${l.team};${l.lineup.join(",")};${l.points}\n`;
    });
    const blob = new Blob([csv], {type:"text/csv"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "wechselhistorie.csv";
    a.click();

    // Reset
    players = [];
    active = { heim:[], gast:[] };
    log = [];
    save();
    render();
  }
}

// Spieler hinzufügen
function addPlayer(){
  const num = document.getElementById("num");
  const pts = document.getElementById("pts");
  const teamSelect = document.getElementById("teamSelect");
  if(!num.value || !pts.value) return;
  players.push({
    num: num.value,
    pts: parseFloat(pts.value),
    team: teamSelect.value
  });
  players.sort((a,b)=>a.num-b.num);
  save(); render();
  num.value=""; pts.value="";
}

// Spieler toggle aktiv
function toggle(team, num){
  const list = active[team];
  const i = list.indexOf(num);
  if(i >= 0) list.splice(i,1);
  else if(list.length < 5) list.push(num);

  logChange(team);
  save(); render();
}

// Spieler löschen
function removePlayer(num, team){
  players = players.filter(p => !(p.num==num && p.team===team));
  active[team] = active[team].filter(n => n!=num);
  save(); render();
}

// Log Eintrag
function logChange(team){
  const lineup = active[team];
  const sum = lineup
    .map(n => players.find(p=>p.num==n)?.pts || 0)
    .reduce((a,b)=>a+b,0);

  log.push({
    time: new Date().toLocaleTimeString(),
    period: currentPeriod,
    team: team==="heim" ? nameHeim.value : nameGast.value,
    lineup: [...lineup],
    points: sum.toFixed(1)
  });
}

// Render
function render(){
  nameHeim.value && (heimTitle.textContent = nameHeim.value);
  nameGast.value && (gastTitle.textContent = nameGast.value);
  renderPeriods();

  ["heim","gast"].forEach(team=>{
    const div = document.getElementById(team+"Players");
    div.innerHTML = "";
    players.filter(p=>p.team===team).forEach(p=>{
      const el = document.createElement("div");
      el.className = "player";
      el.innerHTML = `#${p.num}<br>${p.pts} <span class="remove" onclick="removePlayer(${p.num},'${team}')">×</span>`;
      if(active[team].includes(p.num)) el.classList.add("active");
      el.onclick = (e)=>{
        if(!e.target.classList.contains("remove")) toggle(team, p.num);
      };
      div.appendChild(el);
    });

    const sum = active[team]
      .map(n=>players.find(p=>p.num==n)?.pts || 0)
      .reduce((a,b)=>a+b,0);

    const st = document.getElementById(team+"Status");
    st.textContent = "Punkte: " + sum.toFixed(1);
    st.className = "status " + (sum<=14.5 ? "ok" : "fail");
  });
}

render();
</script>

</body>
</html>
